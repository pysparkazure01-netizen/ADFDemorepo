1) File Name : asset-data-full-2026-01-15T17-36-46-01.json

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.ASSET_JSON_RAW (
    file_name       STRING,
    load_timestamp  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    payload         VARIANT
);


COPY INTO DEV_ADS.PUBLIC.ASSET_JSON_RAW (file_name, payload)
FROM (
    SELECT
        METADATA$FILENAME,
        $1
    FROM @DEV_ADS.PUBLIC.PARSE_TEST/asset-data-full-2026-01-15T17-36-46-01.json
)
FILE_FORMAT = (TYPE = JSON);

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.RAW_ASSET (
    file_name       STRING,
    load_timestamp  TIMESTAMP,
    asset_id        STRING,
    payload         VARIANT
);


INSERT INTO  DEV_ADS.PUBLIC.RAW_ASSET
SELECT
    r.file_name,
    r.load_timestamp,
    a.value:asset_id::STRING AS asset_id,
    a.value                  AS payload
FROM DEV_ADS.PUBLIC.ASSET_JSON_RAW r,
     LATERAL FLATTEN(input => r.payload:assets) a;

     select * from DEV_ADS.PUBLIC.RAW_ASSET
    ;

-------------------------------------------------------------------------------------------------
2) File Name : assetGroups-finding-data-full-2026-01-15T17-36-46-1.json
CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.ASSET_GROUP_JSON_RAW (
    file_name       STRING,
    load_timestamp  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    payload         VARIANT
);


COPY INTO DEV_ADS.PUBLIC.ASSET_GROUP_JSON_RAW (file_name, payload)
FROM (
    SELECT
        METADATA$FILENAME,
        $1
    FROM @DEV_ADS.PUBLIC.PARSE_TEST/assetGroups-finding-data-full-2026-01-15T17-36-46-1.json
	)
FILE_FORMAT = (TYPE = JSON);


CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.RAW_ASSET_GROUP (
    file_name       STRING,
    load_timestamp  TIMESTAMP,
    host_id         STRING,
    asset_group_name STRING,
    payload         VARIANT
);
INSERT INTO DEV_ADS.PUBLIC.RAW_ASSET_GROUP
SELECT
    r.file_name,
    r.load_timestamp,
    g.value:host_id::STRING        AS host_id,
    g.value:asset_group_name::STRING AS asset_group_name,
    g.value                         AS payload
FROM DEV_ADS.PUBLIC.ASSET_GROUP_JSON_RAW r,
     LATERAL FLATTEN(input => r.payload:assetGroups) g;


     select * from  DEV_ADS.PUBLIC.RAW_ASSET_GROUP where host_id=2993644
-----------------------
3) File Name : assets-finding-data-full-2026-01-15T17-36-46-1.json

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.ASSETS_FINDING_JSON_RAW (
    file_name       STRING,
    load_timestamp  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    payload         VARIANT
);


COPY INTO DEV_ADS.PUBLIC.ASSETS_FINDING_JSON_RAW (file_name, payload)
FROM (
    SELECT
        METADATA$FILENAME,
        $1
    FROM @DEV_ADS.PUBLIC.PARSE_TEST/assets-finding-data-full-2026-01-15T17-36-46-1.json
)
FILE_FORMAT = (TYPE = JSON);


CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.RAW_ASSET_FINDING (
    file_name       STRING,
    load_timestamp  TIMESTAMP,
    host_id         STRING,
    payload         VARIANT
);

INSERT INTO DEV_ADS.PUBLIC.RAW_ASSET_FINDING
SELECT
    r.file_name,
    r.load_timestamp,
    a.value:host_id::STRING AS host_id,
    a.value                 AS payload
FROM DEV_ADS.PUBLIC.ASSETS_FINDING_JSON_RAW r,
     LATERAL FLATTEN(input => r.payload:assets) a;

     select * from DEV_ADS.PUBLIC.RAW_ASSET_FINDING

-----------------------
4) File Name : compliance-findings-finding-data-full-2026-01-15T17-36-46-1.json

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.COMPLIANCE_FINDINGS_JSON_RAW (
    file_name       STRING,
    load_timestamp  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    payload         VARIANT
);


COPY INTO DEV_ADS.PUBLIC.COMPLIANCE_FINDINGS_JSON_RAW (file_name, payload)
FROM (
    SELECT
        METADATA$FILENAME,
        $1
    FROM @DEV_ADS.PUBLIC.PARSE_TEST/compliance-findings-finding-data-full-2026-01-15T17-36-46-1.json
)
FILE_FORMAT = (TYPE = JSON);


CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.RAW_COMPLIANCE_FINDING (
    file_name       STRING,
    load_timestamp  TIMESTAMP,
    finding_key     STRING,
    payload         VARIANT
);

INSERT INTO DEV_ADS.PUBLIC.RAW_COMPLIANCE_FINDING
SELECT
    r.file_name,
    r.load_timestamp,
    c.value:finding_key::STRING AS finding_key,
    c.value                      AS payload
FROM DEV_ADS.PUBLIC.COMPLIANCE_FINDINGS_JSON_RAW r,
     LATERAL FLATTEN(input => r.payload:"compliance-findings") c;

     select * from DEV_ADS.PUBLIC.RAW_COMPLIANCE_FINDING
=======================================================================================================	 
5) File Name : compliance-instances-finding-data-full-2026-01-15T17-36-46-1.json

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.COMPLIANCE_INSTANCES_JSON_RAW (
    file_name       STRING,
    load_timestamp  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    payload         VARIANT
);


COPY INTO DEV_ADS.PUBLIC.COMPLIANCE_INSTANCES_JSON_RAW (file_name, payload)
FROM (
    SELECT
        METADATA$FILENAME,
        $1
    FROM @DEV_ADS.PUBLIC.PARSE_TEST/compliance-instances-finding-data-full-2026-01-15T17-36-46-1.json
)
FILE_FORMAT = (TYPE = JSON);

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.RAW_COMPLIANCE_INSTANCE (
    file_name       STRING,
    load_timestamp  TIMESTAMP,
    instance_key    STRING,
    finding_key     STRING,
    payload         VARIANT
);
INSERT INTO DEV_ADS.PUBLIC.RAW_COMPLIANCE_INSTANCE
SELECT
    r.file_name,
    r.load_timestamp,
    i.value:instance_key::STRING AS instance_key,
    i.value:finding_key::STRING  AS finding_key,
    i.value                      AS payload
FROM DEV_ADS.PUBLIC.COMPLIANCE_INSTANCES_JSON_RAW r,
     LATERAL FLATTEN(input => r.payload:"compliance-instances") i;

     select * from DEV_ADS.PUBLIC.RAW_COMPLIANCE_INSTANCE
=======================================================================================================	 
6) File Name : externalIssues-finding-data-full-2026-01-11T00-00-07-1.json

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.EXTERNAL_ISSUES_JSON_RAW (
    file_name       STRING,
    load_timestamp  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    payload         VARIANT
);


COPY INTO DEV_ADS.PUBLIC.EXTERNAL_ISSUES_JSON_RAW (file_name, payload)
FROM (
    SELECT
        METADATA$FILENAME,
        $1
    FROM @DEV_ADS.PUBLIC.PARSE_TEST/externalIssues-finding-data-full-2026-01-11T00-00-07-1.json
)
FILE_FORMAT = (TYPE = JSON);

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.RAW_EXTERNAL_ISSUE (
    file_name       STRING,
    load_timestamp  TIMESTAMP,
    issue_key       STRING,
    finding_key     STRING,
    payload         VARIANT
);

INSERT INTO DEV_ADS.PUBLIC.RAW_EXTERNAL_ISSUE
SELECT
    r.file_name,
    r.load_timestamp,
    e.value:issue_key::STRING   AS issue_key,
    e.value:finding_key::STRING AS finding_key,
    e.value                      AS payload
FROM DEV_ADS.PUBLIC.EXTERNAL_ISSUES_JSON_RAW r,
     LATERAL FLATTEN(input => r.payload:externalIssues) e;

     select * from DEV_ADS.PUBLIC.RAW_EXTERNAL_ISSUE

=======================================================================================================	 
7) File Name : findings-finding-data-full-2026-01-15T17-36-46-1.json

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.FINDINGS_JSON_RAW (
    file_name       STRING,
    load_timestamp  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    payload         VARIANT
);


COPY INTO DEV_ADS.PUBLIC.FINDINGS_JSON_RAW (file_name, payload)
FROM (
    SELECT
        METADATA$FILENAME,
        $1
    FROM @DEV_ADS.PUBLIC.PARSE_TEST/findings-finding-data-full-2026-01-15T17-36-46-1.json
)
FILE_FORMAT = (TYPE = JSON);

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.RAW_FINDING (
    file_name       STRING,
    load_timestamp  TIMESTAMP,
    finding_key     STRING,
    payload         VARIANT
);
INSERT INTO DEV_ADS.PUBLIC.RAW_FINDING
SELECT
    r.file_name,
    r.load_timestamp,
    f.value:finding_key::STRING AS finding_key,
    f.value                      AS payload
FROM DEV_ADS.PUBLIC.FINDINGS_JSON_RAW r,
     LATERAL FLATTEN(input => r.payload:findings) f;

    
=======================================================================================================	 
8) File Name : instances-resolved-finding-data-full-2026-01-15T17-36-46-1.json

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.INSTANCES_RESOLVED_JSON_RAW (
    file_name       STRING,
    load_timestamp  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    payload         VARIANT
);


COPY INTO DEV_ADS.PUBLIC.INSTANCES_RESOLVED_JSON_RAW (file_name, payload)
FROM (
    SELECT
        METADATA$FILENAME,
        $1
    FROM @DEV_ADS.PUBLIC.PARSE_TEST/instances-resolved-finding-data-full-2026-01-15T17-36-46-1.json
)
FILE_FORMAT = (TYPE = JSON);

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.RAW_FINDING_INSTANCE (
    file_name       STRING,
    load_timestamp  TIMESTAMP,
    instance_key    STRING,
    finding_key     STRING,
    payload         VARIANT
);
INSERT INTO DEV_ADS.PUBLIC.RAW_FINDING_INSTANCE
SELECT
    r.file_name,
    r.load_timestamp,
    i.value:instance_key::STRING AS instance_key,
    i.value:finding_key::STRING  AS finding_key,
    i.value                      AS payload
FROM DEV_ADS.PUBLIC.INSTANCES_RESOLVED_JSON_RAW r,
     LATERAL FLATTEN(input => r.payload:"instances-resolved") i;

     select * from DEV_ADS.PUBLIC.RAW_FINDING_INSTANCE
==============================================================================

9) File Name : justifications-finding-data-full-2026-01-15T17-36-46-01.json

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.JUSTIFICATIONS_JSON_RAW (
    file_name       STRING,
    load_timestamp  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    payload         VARIANT
);


COPY INTO DEV_ADS.PUBLIC.JUSTIFICATIONS_JSON_RAW (file_name, payload)
FROM (
    SELECT
        METADATA$FILENAME,
        $1
    FROM @DEV_ADS.PUBLIC.PARSE_TEST/justifications-finding-data-full-2026-01-15T17-36-46-01.json
)
FILE_FORMAT = (TYPE = JSON);

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.RAW_JUSTIFICATION (
    file_name       STRING,
    load_timestamp  TIMESTAMP,
    justification_key STRING,
    finding_key     STRING,
    payload         VARIANT
);
INSERT INTO     DEV_ADS.PUBLIC.RAW_JUSTIFICATION
SELECT
    r.file_name,
    r.load_timestamp,
    j.value:finding_justification_key::STRING  AS justification_key,
    j.value:finding_key::STRING                AS finding_key,  -- may still be null (see note)
    j.value                                    AS payload
FROM DEV_ADS.PUBLIC.JUSTIFICATIONS_JSON_RAW r,
     LATERAL FLATTEN(
         input => r.payload:justifications
     ) j;

     select * from DEV_ADS.PUBLIC.RAW_JUSTIFICATION
==============================================================================

10) File Name : teams-finding-data-full-2026-01-15T17-36-46-01.json

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.TEAMS_JSON_RAW (
    file_name       STRING,
    load_timestamp  TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    payload         VARIANT
);


COPY INTO DEV_ADS.PUBLIC.TEAMS_JSON_RAW (file_name, payload)
FROM (
    SELECT
        METADATA$FILENAME,
        $1
    FROM @DEV_ADS.PUBLIC.PARSE_TEST/teams-finding-data-full-2026-01-15T17-36-46-01.json
)
FILE_FORMAT = (TYPE = JSON);

CREATE OR REPLACE TABLE DEV_ADS.PUBLIC.RAW_FINDING_TEAM (
    file_name                  STRING,
    load_timestamp             TIMESTAMP,
    findings_teams_id          STRING,
    team_id                    STRING,
    team_name                  STRING,
    host_id                    STRING,
    finding_number             STRING,
    scan_type                  STRING,
    finding_justification_key  STRING,
    instance_key               STRING,
    payload                    VARIANT
);
INSERT INTO DEV_ADS.PUBLIC.RAW_FINDING_TEAM
SELECT
    r.file_name,
    r.load_timestamp,
    t.value:findings_teams_id::STRING          AS findings_teams_id,
    t.value:team_id::STRING                    AS team_id,
    t.value:team_name::STRING                  AS team_name,
    t.value:host_id::STRING                    AS host_id,
    t.value:finding_number::STRING             AS finding_number,
    t.value:scan_type::STRING                  AS scan_type,
    t.value:finding_justification_key::STRING  AS finding_justification_key,
    t.value:instance_key::STRING               AS instance_key,
    t.value                                    AS payload
FROM DEV_ADS.PUBLIC.TEAMS_JSON_RAW r,
     LATERAL FLATTEN(
         input => r.payload:teams
     ) t;
